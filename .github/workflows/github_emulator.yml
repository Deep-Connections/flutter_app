name: Firebase CI

on: [ push ]

jobs:
  firebase:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repo
        uses: actions/checkout@v4

      - uses: actions/cache@v4
        with:
          path: |
            ~/.cache/firebase/emulators
          key: ${{ runner.os }}-firebase-emulators-${{ hashFiles('**/lockfiles') }}

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: 'npm'
 
      - name: Install Firebase CLI
        run: npm install -g firebase-tools

      # - name: Firestore installs
      #   working-directory: ./firebase
      #   run: npm install

      # - name: Firestore test
      #   run: firebase emulators:exec --only firestore 'cd firebase && npm test'

      - name: Javascript functions installs
        working-directory: ./functions/javascript
        run: npm install

      - name: Javascript function tests
        run: firebase emulators:exec --only firestore,storage,auth 'cd functions/javascript && npm test'